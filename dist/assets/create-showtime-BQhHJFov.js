import{r as l,y as w,l as e,T as x,W as o,B as y,J as _,A as v}from"./TextField-BYjjVj_2.js";import{D as C,C as T,a as b,b as S,S as k,H as A}from"./admin-D2fVXrBE.js";import{S as F}from"./Stack-CclBrxki.js";import{A as I}from"./Autocomplete-p6Kcj2hd.js";function N(){const[s,h]=l.useState({film_name:"",room_name:"",cinema_name:"",show_date:"",show_time:""}),[p,g]=l.useState([]),[u,r]=l.useState({open:!1,message:"",severity:"success"}),f=w(),d=()=>r(a=>({...a,open:!1})),i=a=>{const{name:t,value:n}=a.target;h(m=>({...m,[t]:n}))},j=async a=>{a.preventDefault();const t={...s,show_date:s.show_date,show_time:s.show_time};try{const n=localStorage.getItem("jwt");if(!n){console.error("JWT token is missing"),r({open:!0,message:"JWT token is missing",severity:"error"});return}if(!(await fetch("/api/admin/showtimes/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify(t)})).ok)throw new Error("Failed to create showtime");r({open:!0,message:"Suất chiếu phim đã được tạo thành công!",severity:"success"}),setTimeout(()=>f("/admin/showtime"),1e3)}catch{r({open:!0,message:"Có lỗi xảy ra khi tạo suất chiếu!",severity:"error"}),h({film_name:"",room_name:"",cinema_name:"",show_date:"",show_time:""})}};return l.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("jwt");if(!t){console.error("JWT token is missing"),r({open:!0,message:`Lỗi khi gọi API: ${error.message}`,severity:"error"});return}const n=await fetch("/api/admin/films",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}});if(!n.ok){const c=await n.json();throw new Error(c.message||"Failed to fetch films")}const m=await n.json();g(m.map(c=>c.film_name))}catch(t){r({open:!0,message:`Lỗi khi gọi API: ${t.message}`,severity:"error"})}})()},[]),e.jsxs(C,{children:[e.jsxs(T,{children:[e.jsx(b,{title:e.jsx(x,{variant:"h2",children:"Mẫu tạo suất chiếu phim mới"})}),e.jsx(S,{children:e.jsxs("form",{onSubmit:j,children:[e.jsxs(F,{spacing:3,children:[e.jsx(I,{name:"film_name",options:p,isOptionEqualToValue:(a,t)=>t!==null&&a.value===t.value,value:s.film_name,onChange:(a,t)=>{h({...s,film_name:t})},renderInput:a=>e.jsx(o,{...a,label:"Tên phim",placeholder:"Vui lòng chọn hoặc nhập tên phim",required:!0})}),e.jsx(o,{name:"room_name",label:"Tên phòng",value:s.room_name,onChange:i,required:!0,fullWidth:!0}),e.jsx(o,{name:"cinema_name",label:"Tên rạp",value:s.cinema_name,onChange:i,required:!0,fullWidth:!0}),e.jsx(o,{name:"show_date",label:"Ngày chiếu",type:"date",InputLabelProps:{shrink:!0},value:s.show_date,onChange:i,required:!0,fullWidth:!0}),e.jsx(o,{name:"show_time",label:"Giờ chiếu",type:"time",InputLabelProps:{shrink:!0},value:s.show_time,onChange:i,required:!0,fullWidth:!0})]}),e.jsx(y,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(_,{type:"submit",variant:"contained",color:"primary",children:"Tạo suất chiếu"})})]})})]}),e.jsx(k,{open:u.open,autoHideDuration:4e3,onClose:d,children:e.jsx(v,{onClose:d,severity:u.severity,children:u.message})})]})}function P(){return e.jsxs(e.Fragment,{children:[e.jsx(A,{children:e.jsxs("title",{children:[" ","Tạo suất chiếu | Trang quản trị website bán vé xem phim NHTT"]})}),e.jsx(N,{})]})}export{P as default};
