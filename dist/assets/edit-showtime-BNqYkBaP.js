import{r as i,y as W,l as e,T as F,B as _,W as c,J as I,A as N,a4 as P}from"./TextField-BYjjVj_2.js";import{D as q,C as J,a as L,b as $,c as B,S as H,H as z}from"./admin-CrwPeCkE.js";import{S as G}from"./Stack-CclBrxki.js";import{A as O}from"./Autocomplete-66Y6C1PU.js";function V({showtimeId:l}){const[r,u]=i.useState({film_name:"",room_name:"",cinema_name:"",show_date:"",show_time:""}),[C,v]=i.useState([]),[S,T]=i.useState(null),[b,k]=i.useState(!0),[g,n]=i.useState({open:!1,message:"",severity:"success"}),D=W(),f=()=>n(s=>({...s,open:!1})),d=s=>{const{name:t,value:a}=s.target;u(o=>({...o,[t]:a}))};i.useEffect(()=>{(async()=>{var t,a,o,m,w;try{const p=localStorage.getItem("jwt");if(!p){console.error("JWT token is missing"),n({open:!0,message:"JWT token is missing",severity:"error"});return}const j=await fetch(`/api/admin/showtimes/detail/${l}`,{method:"GET",headers:{Authorization:"Bearer "+p}});if(!j.ok)throw new Error("Failed to fetch showtime details");const h=await j.json(),x=((t=h.showTime[0])==null?void 0:t.show_date)||"",A=x?new Date(x).toLocaleDateString("en-CA"):"",y={film_name:((a=h.film[0])==null?void 0:a.film_name)||"",room_name:((o=h.room[0])==null?void 0:o.room_name)||"",cinema_name:((m=h.cinema[0])==null?void 0:m.cinema_name)||"",show_date:A,show_time:((w=h.showTime[0])==null?void 0:w.show_time)||""};u(y),T(y),k(!1)}catch(p){console.error(p),n({open:!0,message:"Lỗi khi tải thông tin suất chiếu",severity:"error"})}})()},[l]);const E=async s=>{s.preventDefault();try{const t=localStorage.getItem("jwt");if(!t){console.error("JWT token is missing"),n({open:!0,message:"JWT token is missing",severity:"error"});return}if(!(await fetch(`/api/admin/showtimes/edit/${l}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t},body:JSON.stringify(r)})).ok)throw new Error("Failed to update showtime");n({open:!0,message:"Suất chiếu phim đã được cập nhật thành công!",severity:"success"}),setTimeout(()=>D("/admin/showtime"),1e3)}catch{n({open:!0,message:"Có lỗi xảy ra khi cập nhật suất chiếu!",severity:"error"}),u(S)}};return i.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("jwt");if(!t){console.error("JWT token is missing"),n({open:!0,message:`Lỗi khi gọi API: ${error.message}`,severity:"error"});return}const a=await fetch("/api/admin/films",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}});if(!a.ok){const m=await a.json();throw new Error(m.message||"Failed to fetch films")}const o=await a.json();v(o.map(m=>m.film_name))}catch(t){n({open:!0,message:`Lỗi khi gọi API: ${t.message}`,severity:"error"})}})()},[]),e.jsxs(q,{children:[e.jsxs(J,{children:[e.jsx(L,{title:e.jsx(F,{variant:"h2",children:"Chỉnh sửa thông tin suất chiếu phim"})}),e.jsx($,{children:b?e.jsx(_,{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",children:e.jsx(B,{})}):e.jsxs("form",{onSubmit:E,children:[e.jsxs(G,{spacing:3,children:[e.jsx(O,{name:"film_name",options:C,isOptionEqualToValue:(s,t)=>t!==null&&s.value===t.value,value:r.film_name,onChange:(s,t)=>{u({...r,film_name:t})},renderInput:s=>e.jsx(c,{...s,label:"Tên phim",placeholder:"Vui lòng chọn hoặc nhập tên phim",required:!0,fullWidth:!0})}),e.jsx(c,{name:"room_name",label:"Tên phòng chiếu",value:r.room_name,onChange:d,required:!0,fullWidth:!0}),e.jsx(c,{name:"cinema_name",label:"Tên rạp",value:r.cinema_name,onChange:d,required:!0,fullWidth:!0}),e.jsx(c,{name:"show_date",label:"Ngày chiếu",type:"date",value:r.show_date,onChange:d,required:!0,fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsx(c,{name:"show_time",label:"Giờ chiếu",type:"time",value:r.show_time,onChange:d,required:!0,fullWidth:!0,InputLabelProps:{shrink:!0}})]}),e.jsx(_,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(I,{type:"submit",variant:"contained",color:"primary",children:"Cập nhật"})})]})})]}),e.jsx(H,{open:g.open,autoHideDuration:4e3,onClose:f,children:e.jsx(N,{onClose:f,severity:g.severity,children:g.message})})]})}function U(){const{id:l}=P();return e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsxs("title",{children:[" ","Chỉnh sửa thông tin suất chiếu | Trang quản trị website bán vé xem phim NHTT"]})}),e.jsx(V,{showtimeId:l})]})}export{U as default};
