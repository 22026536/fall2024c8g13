import{r as g,l as e,T as f,W as l,B as c,J as d,P as x,A as w}from"./TextField-BYjjVj_2.js";import{D as S,C as R,a as W,b as D,i as k,S as A,H as F}from"./admin-CrwPeCkE.js";import{S as H}from"./Stack-CclBrxki.js";import{A as b}from"./Autocomplete-66Y6C1PU.js";function L(){const[r,o]=g.useState({film_name:"",film_img:null,film_trailer:"",Release_date:"",film_describe:"",age_limit:5,duration:"",film_type:1,country:1,categories:[],directors:[],actors:[]}),[u,m]=g.useState({open:!1,message:"",severity:"success"}),y=[{value:"1",label:"Đang chiếu"},{value:"0",label:"Sắp chiếu"}],j=[{value:"1",label:"Việt Nam"},{value:"0",label:"Nước ngoài"}],h=()=>m(t=>({...t,open:!1})),s=t=>{const{name:a,value:i}=t.target;o(n=>({...n,[a]:i}))},v=()=>{o(t=>({...t,film_img:null}))},_=t=>{const a=t.target.files[0];if(a){const i=new FileReader;i.onload=()=>{o(n=>({...n,film_img:i.result}))},i.readAsDataURL(a)}},C=async t=>{t.preventDefault();const a=new FormData;a.append("film_name",r.film_name),a.append("film_trailer",r.film_trailer),a.append("Release_date",r.Release_date),a.append("film_describe",r.film_describe),a.append("age_limit",r.age_limit),a.append("duration",r.duration),a.append("film_type",r.film_type),a.append("country",r.country),r.film_img&&a.append("film_img",r.film_img),a.append("actors",r.actors),a.append("directors",r.directors),a.append("categories",r.categories);try{const i=localStorage.getItem("jwt");if(!i){console.error("JWT token is missing");return}if(!(await fetch("/api/admin/films/create",{method:"POST",headers:{Authorization:"Bearer "+i},body:a})).ok)throw new Error("Failed to create movie");m({open:!0,message:"Phim đã được tạo thành công!",severity:"success"}),setTimeout(()=>navigate("/admin/movie"),1e3)}catch{o({film_name:"",film_img:null,film_trailer:"",Release_date:"",film_describe:"",age_limit:5,duration:"",film_type:1,country:1,categories:[],directors:[],actors:[]}),m({open:!0,message:"Có lỗi xảy ra khi tạo phim!",severity:"error"})}},T=t=>{try{const a=/(?:https?:\/\/)?youtu\.be\/([^&\s]+)/,i=t.match(a);if(i)return`https://www.youtube.com/embed/${i[1]}`;const n=/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&\s]+)/,p=t.match(n);return p?`https://www.youtube.com/embed/${p[1]}`:t}catch(a){return console.error("Error transforming YouTube URL:",a),t}};return e.jsxs(S,{children:[e.jsxs(R,{children:[e.jsx(W,{title:e.jsx(f,{variant:"h2",children:"Mẫu tạo phim mới"})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:C,children:[e.jsxs(H,{spacing:3,children:[e.jsx(l,{name:"film_name",label:"Tên phim",value:r.film_name,onChange:s,required:!0,fullWidth:!0}),e.jsxs(c,{display:"flex",flexDirection:"column",alignItems:"center",sx:{width:"300px"},children:[e.jsx(c,{sx:{width:"300px",height:"450px",backgroundColor:"#e0e0e0",border:"1px solid #ccc",borderRadius:"4px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",overflow:"hidden"},children:r.film_img?e.jsx("img",{src:r.film_img,alt:"Movie Poster",style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"}}):e.jsx(f,{variant:"caption",color:"textSecondary",sx:{textAlign:"center"},children:"Chưa có poster phim"})}),e.jsx(c,{sx:{marginTop:"10px"},children:r.film_img?e.jsx(d,{onClick:v,variant:"outlined",color:"error",size:"small",children:"Xóa poster phim"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{accept:"image/*",id:"upload-poster",type:"file",style:{display:"none"},onChange:_}),e.jsx("label",{htmlFor:"upload-poster",children:e.jsx(d,{variant:"outlined",color:"info",size:"small",component:"span",children:"Thêm poster phim"})})]})})]}),r.film_trailer&&e.jsx(c,{children:e.jsx("iframe",{width:"50%",height:"315",src:T(r.film_trailer),title:"Movie Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsx(l,{name:"film_trailer",label:"Trailer URL (Shortened URL or Standard URL)",value:r.film_trailer,onChange:s,fullWidth:!0}),e.jsx(l,{name:"Release_date",label:"Ngày phát hành",type:"date",InputLabelProps:{shrink:!0},value:r.Release_date,onChange:s,required:!0,fullWidth:!0}),e.jsx(l,{name:"film_describe",label:"Mô tả",value:r.film_describe,onChange:s,multiline:!0,rows:4,required:!0,fullWidth:!0}),e.jsx(b,{name:"age_limit",options:[5,13,16,18],isOptionEqualToValue:(t,a)=>a!==null&&t.value===a.value,value:r.age_limit,onChange:(t,a)=>{o({...r,age_limit:a})},getOptionLabel:t=>t.toString(),renderInput:t=>e.jsx(l,{...t,name:"age_limit",label:"Giới hạn độ tuổi",type:"number",fullWidth:!0,required:!0})}),e.jsx(l,{name:"duration",label:"Thời lượng (phút)",type:"number",value:r.duration,onChange:s,required:!0,fullWidth:!0}),e.jsx(l,{name:"film_type",label:"Trạng thái phim",select:!0,value:r.film_type,onChange:s,required:!0,fullWidth:!0,children:y.map(t=>e.jsx(x,{value:t.value,children:t.label},t.value))}),e.jsx(l,{name:"country",label:"Quốc gia",select:!0,value:r.country,onChange:s,required:!0,fullWidth:!0,children:j.map(t=>e.jsx(x,{value:t.value,children:t.label},t.value))}),e.jsx(b,{multiple:!0,freeSolo:!0,options:["Kinh Dị","Hài Kịch","Hành Động","Tội Phạm","Phiêu Lưu","Hoạt Hình","Gia Đình","Khoa Học Viễn Tưởng","Bí Ẩn","Giả Tưởng","Lãng Mạng","Drama","Giật Gân","Âm Nhạc","Tiểu Sử","Lịch Sử","Chiến Tranh"],value:r.categories,onChange:(t,a)=>{o(i=>({...i,categories:a}))},renderTags:(t,a)=>t.map((i,n)=>e.jsx(k,{variant:"outlined",label:i,...a({index:n})},i)),renderInput:t=>e.jsx(l,{...t,label:"Thể loại",placeholder:"Thêm thể loại (cách nhau bởi dấu phẩy)"})}),e.jsx(l,{name:"directors",label:"Đạo diễn",placeholder:"Thêm đạo diễn (cách nhau bởi dấu phẩy)",value:r.directors.join(", "),onChange:t=>{const i=t.target.value.split(",").map(n=>n.trim());o(n=>({...n,directors:i}))},fullWidth:!0}),e.jsx(l,{name:"actors",label:"Diễn viên",placeholder:"Thêm diễn viên (cách nhau bởi dấu phẩy)",value:r.actors.join(", "),onChange:t=>{const i=t.target.value.split(",").map(n=>n.trim());o(n=>({...n,actors:i}))},fullWidth:!0})]}),e.jsx(c,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(d,{type:"submit",variant:"contained",color:"primary",children:"Tạo phim"})})]})})]}),e.jsx(A,{open:u.open,autoHideDuration:4e3,onClose:h,children:e.jsx(w,{onClose:h,severity:u.severity,children:u.message})})]})}function V(){return e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsxs("title",{children:[" ","Tạo phim | Trang quản trị website bán vé xem phim NHTT"]})}),e.jsx(L,{})]})}export{V as default};
