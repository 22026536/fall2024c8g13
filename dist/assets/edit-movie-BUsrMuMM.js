import{r as p,y as q,l as e,T as k,B as m,W as s,J as _,P as N,A as B,a4 as G}from"./TextField-BYjjVj_2.js";import{D as J,C as U,a as $,b as O,c as z,i as K,S as V,H as Y}from"./admin-D2fVXrBE.js";import{S as X}from"./Stack-CclBrxki.js";import{A as Q}from"./Autocomplete-p6Kcj2hd.js";function Z({movieId:h}){const[t,c]=p.useState({film_name:"",film_img:null,film_trailer:"",Release_date:"",film_describe:"",age_limit:"",duration:"",film_type:1,categories:[],directors:[],actors:[]}),[W,F]=p.useState(t),L=q(),[P,b]=p.useState(!0),[x,f]=p.useState({open:!1,message:"",severity:"success"}),A=[{value:1,label:"Đang chiếu"},{value:0,label:"Sắp chiếu"}],y=()=>f(a=>({...a,open:!1}));p.useEffect(()=>{(async()=>{var i,r,n,d,j,v,w,C,S,T;try{const g=localStorage.getItem("jwt");if(!g){console.error("JWT token is missing");return}const D=await fetch(`/api/admin/films/detail/${h}`,{method:"GET",headers:{Authorization:"Bearer "+g}});if(!D.ok)throw new Error("Failed to fetch movie details");const l=await D.json(),R={film_name:(i=l.film[0])==null?void 0:i.film_name,film_img:l.film[0].film_img,film_trailer:(r=l.film[0])==null?void 0:r.film_trailer,Release_date:new Date((n=l.film[0])==null?void 0:n.Release_date).toLocaleDateString("en-CA"),film_describe:(d=l.film[0])==null?void 0:d.film_describe,age_limit:(j=l.film[0])==null?void 0:j.age_limit,duration:(v=l.film[0])==null?void 0:v.duration,film_type:(w=l.film[0])==null?void 0:w.film_type,categories:[...new Set((C=l.categories)==null?void 0:C.map(u=>u.category_name))],directors:[...new Set((S=l.directors)==null?void 0:S.map(u=>u.director_name))],actors:[...new Set((T=l.actors)==null?void 0:T.map(u=>u.actor_name))]};c(R),F(R),b(!1)}catch(g){console.error(g),f({open:!0,message:"Lỗi khi tải thông tin phim",severity:"error"}),b(!1)}})()},[h]);const o=a=>{const{name:i,value:r}=a.target;c(n=>({...n,[i]:r}))},H=()=>{c(a=>({...a,film_img:null}))},E=a=>{const i=a.target.files[0];if(i){const r=new FileReader;r.onload=()=>{c(n=>({...n,film_img:r.result}))},r.readAsDataURL(i)}},I=async a=>{a.preventDefault();const i=new FormData;i.append("film_name",t.film_name),i.append("film_trailer",t.film_trailer),i.append("Release_date",t.Release_date),i.append("film_describe",t.film_describe),i.append("age_limit",t.age_limit),i.append("duration",t.duration),i.append("film_type",t.film_type),t.film_img&&i.append("film_img",t.film_img),i.append("categories",JSON.stringify(t.categories)),i.append("directors",JSON.stringify(t.directors)),i.append("actors",JSON.stringify(t.actors));try{const r=localStorage.getItem("jwt");if(!r){console.error("JWT token is missing");return}if(!(await fetch(`/api/admin/films/edit/${h}`,{method:"PATCH",headers:{Authorization:"Bearer "+r},body:i})).ok)throw new Error("Failed to update movie");f({open:!0,message:"Phim đã được cập nhật thành công!",severity:"success"}),setTimeout(()=>L("/admin/movie"),1e3)}catch{f({open:!0,message:"Có lỗi xảy ra khi cập nhật phim!",severity:"error"}),c(W)}},M=a=>{try{const i=/(?:https?:\/\/)?youtu\.be\/([^&\s]+)/,r=a.match(i);if(r)return`https://www.youtube.com/embed/${r[1]}`;const n=/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&\s]+)/,d=a.match(n);return d?`https://www.youtube.com/embed/${d[1]}`:a}catch(i){return console.error("Error transforming YouTube URL:",i),a}};return e.jsxs(J,{children:[e.jsxs(U,{children:[e.jsx($,{title:e.jsx(k,{variant:"h2",children:"Chỉnh sửa thông tin phim"})}),e.jsx(O,{children:P?e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",children:e.jsx(z,{})}):e.jsxs("form",{onSubmit:I,children:[e.jsxs(X,{spacing:3,children:[e.jsx(s,{name:"film_name",label:"Tên phim",value:t.film_name,onChange:o,required:!0,fullWidth:!0}),e.jsxs(m,{display:"flex",flexDirection:"column",alignItems:"center",sx:{width:"300px"},children:[e.jsx(m,{sx:{width:"300px",height:"450px",backgroundColor:"#e0e0e0",border:"1px solid #ccc",borderRadius:"4px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",overflow:"hidden"},children:t.film_img?e.jsx("img",{src:t.film_img,alt:"Movie Poster",style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"}}):e.jsx(k,{variant:"caption",color:"textSecondary",sx:{textAlign:"center"},children:"Chưa có poster phim"})}),e.jsx(m,{sx:{marginTop:"10px"},children:t.film_img?e.jsx(_,{onClick:H,variant:"outlined",color:"error",size:"small",children:"Xóa poster phim"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{accept:"image/*",id:"upload-poster",type:"file",style:{display:"none"},onChange:E}),e.jsx("label",{htmlFor:"upload-poster",children:e.jsx(_,{variant:"outlined",color:"info",size:"small",component:"span",children:"Thêm poster phim"})})]})})]}),t.film_trailer&&e.jsx(m,{children:e.jsx("iframe",{width:"50%",height:"315",src:M(t.film_trailer),title:"Movie Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsx(s,{name:"film_trailer",label:"Trailer URL (Shortened URL or Standard URL)",value:t.film_trailer,onChange:o,fullWidth:!0}),e.jsx(s,{name:"Release_date",label:"Ngày phát hành",type:"date",InputLabelProps:{shrink:!0},value:t.Release_date,onChange:o,required:!0,fullWidth:!0}),e.jsx(s,{name:"film_describe",label:"Mô tả",value:t.film_describe,onChange:o,multiline:!0,rows:15,required:!0,fullWidth:!0}),e.jsx(s,{name:"age_limit",label:"Giới hạn độ tuổi",type:"number",value:t.age_limit,onChange:o,required:!0,fullWidth:!0}),e.jsx(s,{name:"duration",label:"Thời lượng (phút)",type:"number",value:t.duration,onChange:o,required:!0,fullWidth:!0}),e.jsx(s,{name:"film_type",label:"Trạng thái phim",select:!0,value:t.film_type,onChange:o,required:!0,fullWidth:!0,children:A.map(a=>e.jsx(N,{value:a.value,children:a.label},a.value))}),e.jsx(Q,{multiple:!0,freeSolo:!0,options:["Kinh Dị","Hài Kịch","Hành Động","Tội Phạm","Phiêu Lưu","Hoạt Hình","Gia Đình","Khoa Học Viễn Tưởng","Bí Ẩn","Giả Tưởng","Lãng Mạng","Drama","Giật Gân","Âm Nhạc","Tiểu Sử","Lịch Sử","Chiến Tranh"],value:t.categories,onChange:(a,i)=>{c(r=>({...r,categories:i}))},renderTags:(a,i)=>a.map((r,n)=>e.jsx(K,{variant:"outlined",label:r,...i({index:n})},r)),renderInput:a=>e.jsx(s,{...a,label:"Thể loại",placeholder:"Thêm thể loại (cách nhau bởi dấu phẩy)"})}),e.jsx(s,{name:"directors",label:"Đạo diễn",placeholder:"Thêm đạo diễn (cách nhau bởi dấu phẩy)",value:t.directors,onChange:o,fullWidth:!0}),e.jsx(s,{name:"actors",label:"Diễn viên",placeholder:"Thêm diễn viên (cách nhau bởi dấu phẩy)",value:t.actors,onChange:o,fullWidth:!0})]}),e.jsx(m,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(_,{type:"submit",variant:"contained",color:"primary",children:"Cập nhật"})})]})})]}),e.jsx(V,{open:x.open,autoHideDuration:4e3,onClose:y,children:e.jsx(B,{onClose:y,severity:x.severity,children:x.message})})]})}function re(){const{id:h}=G();return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsxs("title",{children:[" ","Chỉnh sửa thông tin phim | Trang quản trị website bán vé xem phim NHTT"]})}),e.jsx(Z,{movieId:h})]})}export{re as default};
