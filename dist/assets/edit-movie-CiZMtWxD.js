import{r as p,y as N,l as e,T as k,B as m,W as s,J as y,P as A,A as U,a4 as $}from"./TextField-BYjjVj_2.js";import{D as z,C as O,a as J,b as K,c as Y,i as Q,S as X,H as Z}from"./admin-7nJNdn2s.js";import{S as ee}from"./Stack-CclBrxki.js";import{A as F}from"./Autocomplete-C8kf00Qd.js";function te({movieId:u}){const[i,o]=p.useState({film_name:"",film_img:null,film_trailer:"",Release_date:"",film_describe:"",age_limit:5,duration:"",film_type:1,country:1,categories:[],directors:[],actors:[]}),[L,P]=p.useState(i),H=N(),[I,b]=p.useState(!0),[x,f]=p.useState({open:!1,message:"",severity:"success"}),E=[{value:1,label:"Đang chiếu"},{value:0,label:"Sắp chiếu"}],M=[{value:"1",label:"Việt Nam"},{value:"0",label:"Nước ngoài"}],j=()=>f(t=>({...t,open:!1})),c=t=>{const{name:a,value:r}=t.target;o(n=>({...n,[a]:r}))};p.useEffect(()=>{(async()=>{var a,r,n,d,_,v,C,w,T,S,D;try{const g=localStorage.getItem("jwt");if(!g){console.error("JWT token is missing");return}const R=await fetch(`/api/admin/films/detail/${u}`,{method:"GET",headers:{Authorization:"Bearer "+g}});if(!R.ok)throw new Error("Failed to fetch movie details");const l=await R.json(),W={film_name:(a=l.film[0])==null?void 0:a.film_name,film_img:l.film[0].film_img,film_trailer:(r=l.film[0])==null?void 0:r.film_trailer,Release_date:new Date((n=l.film[0])==null?void 0:n.Release_date).toLocaleDateString("en-CA"),film_describe:(d=l.film[0])==null?void 0:d.film_describe,age_limit:(_=l.film[0])==null?void 0:_.age_limit,duration:(v=l.film[0])==null?void 0:v.duration,film_type:(C=l.film[0])==null?void 0:C.film_type,country:(w=l.film[0])==null?void 0:w.country,actors:((T=l.actors)==null?void 0:T.map(h=>h.actor_name))||[],directors:((S=l.directors)==null?void 0:S.map(h=>h.director_name))||[],categories:((D=l.categories)==null?void 0:D.map(h=>h.category_name))||[]};o(W),P(W),b(!1)}catch(g){console.error(g),f({open:!0,message:"Lỗi khi tải thông tin phim",severity:"error"}),b(!1)}})()},[u]);const q=()=>{o(t=>({...t,film_img:null}))},V=t=>{const a=t.target.files[0];if(a){const r=new FileReader;r.onload=()=>{o(n=>({...n,film_img:r.result}))},r.readAsDataURL(a)}},B=async t=>{t.preventDefault();const a=new FormData;a.append("film_name",i.film_name),a.append("film_trailer",i.film_trailer),a.append("Release_date",i.Release_date),a.append("film_describe",i.film_describe),a.append("age_limit",i.age_limit),a.append("duration",i.duration),a.append("film_type",i.film_type),a.append("country",i.country),i.film_img&&a.append("film_img",i.film_img),a.append("categories",i.categories),a.append("directors",i.directors),a.append("actors",i.actors);try{const r=localStorage.getItem("jwt");if(!r){console.error("JWT token is missing");return}if(!(await fetch(`/api/admin/films/edit/${u}`,{method:"PATCH",headers:{Authorization:"Bearer "+r},body:a})).ok)throw new Error("Failed to update movie");f({open:!0,message:"Phim đã được cập nhật thành công!",severity:"success"}),setTimeout(()=>H("/admin/movie"),1e3)}catch{f({open:!0,message:"Có lỗi xảy ra khi cập nhật phim!",severity:"error"}),o(L)}},G=t=>{try{const a=/(?:https?:\/\/)?youtu\.be\/([^&\s]+)/,r=t.match(a);if(r)return`https://www.youtube.com/embed/${r[1]}`;const n=/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&\s]+)/,d=t.match(n);return d?`https://www.youtube.com/embed/${d[1]}`:t}catch(a){return console.error("Error transforming YouTube URL:",a),t}};return e.jsxs(z,{children:[e.jsxs(O,{children:[e.jsx(J,{title:e.jsx(k,{variant:"h2",children:"Chỉnh sửa thông tin phim"})}),e.jsx(K,{children:I?e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",children:e.jsx(Y,{})}):e.jsxs("form",{onSubmit:B,children:[e.jsxs(ee,{spacing:3,children:[e.jsx(s,{name:"film_name",label:"Tên phim",value:i.film_name,onChange:c,required:!0,fullWidth:!0}),e.jsxs(m,{display:"flex",flexDirection:"column",alignItems:"center",sx:{width:"300px"},children:[e.jsx(m,{sx:{width:"300px",height:"450px",backgroundColor:"#e0e0e0",border:"1px solid #ccc",borderRadius:"4px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",overflow:"hidden"},children:i.film_img?e.jsx("img",{src:i.film_img,alt:"Movie Poster",style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"}}):e.jsx(k,{variant:"caption",color:"textSecondary",sx:{textAlign:"center"},children:"Chưa có poster phim"})}),e.jsx(m,{sx:{marginTop:"10px"},children:i.film_img?e.jsx(y,{onClick:q,variant:"outlined",color:"error",size:"small",children:"Xóa poster phim"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{accept:"image/*",id:"upload-poster",type:"file",style:{display:"none"},onChange:V}),e.jsx("label",{htmlFor:"upload-poster",children:e.jsx(y,{variant:"outlined",color:"info",size:"small",component:"span",children:"Thêm poster phim"})})]})})]}),i.film_trailer&&e.jsx(m,{children:e.jsx("iframe",{width:"50%",height:"315",src:G(i.film_trailer),title:"Movie Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsx(s,{name:"film_trailer",label:"Trailer URL (Shortened URL or Standard URL)",value:i.film_trailer,onChange:c,fullWidth:!0}),e.jsx(s,{name:"Release_date",label:"Ngày phát hành",type:"date",InputLabelProps:{shrink:!0},value:i.Release_date,onChange:c,required:!0,fullWidth:!0}),e.jsx(s,{name:"film_describe",label:"Mô tả",value:i.film_describe,onChange:c,multiline:!0,rows:15,required:!0,fullWidth:!0}),e.jsx(F,{options:[5,13,16,18],value:i.age_limit,onChange:(t,a)=>{o({...i,age_limit:a})},getOptionLabel:t=>t.toString(),renderInput:t=>e.jsx(s,{...t,name:"age_limit",label:"Giới hạn độ tuổi",type:"number",fullWidth:!0,required:!0})}),e.jsx(s,{name:"duration",label:"Thời lượng (phút)",type:"number",value:i.duration,onChange:c,required:!0,fullWidth:!0}),e.jsx(s,{name:"film_type",label:"Trạng thái phim",select:!0,value:i.film_type,onChange:c,required:!0,fullWidth:!0,children:E.map(t=>e.jsx(A,{value:t.value,children:t.label},t.value))}),e.jsx(s,{name:"country",label:"Quốc gia",select:!0,value:i.country,onChange:c,required:!0,fullWidth:!0,children:M.map(t=>e.jsx(A,{value:t.value,children:t.label},t.value))}),e.jsx(F,{multiple:!0,freeSolo:!0,options:["Kinh Dị","Hài Kịch","Hành Động","Tội Phạm","Phiêu Lưu","Hoạt Hình","Gia Đình","Khoa Học Viễn Tưởng","Bí Ẩn","Giả Tưởng","Lãng Mạng","Drama","Giật Gân","Âm Nhạc","Tiểu Sử","Lịch Sử","Chiến Tranh"],value:i.categories,onChange:(t,a)=>{o(r=>({...r,categories:a}))},renderTags:(t,a)=>t.map((r,n)=>e.jsx(Q,{variant:"outlined",label:r,...a({index:n})},r)),renderInput:t=>e.jsx(s,{...t,label:"Thể loại",placeholder:"Thêm thể loại (cách nhau bởi dấu phẩy)"})}),e.jsx(s,{name:"directors",label:"Đạo diễn",placeholder:"Thêm đạo diễn (cách nhau bởi dấu phẩy)",value:i.directors.join(", "),onChange:t=>{const r=t.target.value.split(",").map(n=>n.trim());o(n=>({...n,directors:r}))},fullWidth:!0}),e.jsx(s,{name:"actors",label:"Diễn viên",placeholder:"Thêm diễn viên (cách nhau bởi dấu phẩy)",value:i.actors.join(", "),onChange:t=>{const r=t.target.value.split(",").map(n=>n.trim());o(n=>({...n,actors:r}))},fullWidth:!0})]}),e.jsx(m,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(y,{type:"submit",variant:"contained",color:"primary",children:"Cập nhật"})})]})})]}),e.jsx(X,{open:x.open,autoHideDuration:4e3,onClose:j,children:e.jsx(U,{onClose:j,severity:x.severity,children:x.message})})]})}function le(){const{id:u}=$();return e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:e.jsxs("title",{children:[" ","Chỉnh sửa thông tin phim | Trang quản trị website bán vé xem phim NHTT"]})}),e.jsx(te,{movieId:u})]})}export{le as default};
