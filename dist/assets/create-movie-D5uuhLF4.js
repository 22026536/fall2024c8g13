import{r as f,l as e,T as g,W as l,B as c,J as d,P as x,A as w}from"./TextField-BYjjVj_2.js";import{D as T,C as S,a as R,b as W,S as k,H as D}from"./admin-aUXBJIL_.js";import{S as F}from"./Stack-CclBrxki.js";import{A as q}from"./Autocomplete-MHBazz2M.js";function A(){const[t,o]=f.useState({film_name:"",film_img:null,film_trailer:"",Release_date:"",film_describe:"",age_limit:5,duration:"",film_type:1,country:1,categories:[],directors:[],actors:[]}),[m,u]=f.useState({open:!1,message:"",severity:"success"}),b=[{value:"1",label:"Đang chiếu"},{value:"0",label:"Sắp chiếu"}],y=[{value:"1",label:"Việt Nam"},{value:"0",label:"Nước ngoài"}],h=()=>u(r=>({...r,open:!1})),n=r=>{const{name:a,value:i}=r.target;o(s=>({...s,[a]:i}))},j=()=>{o(r=>({...r,film_img:null}))},_=r=>{const a=r.target.files[0];if(a){const i=new FileReader;i.onload=()=>{o(s=>({...s,film_img:i.result}))},i.readAsDataURL(a)}},v=async r=>{r.preventDefault();const a=new FormData;console.log(t),a.append("film_name",t.film_name),a.append("film_trailer",t.film_trailer),a.append("Release_date",t.Release_date),a.append("film_describe",t.film_describe),a.append("age_limit",t.age_limit),a.append("duration",t.duration),a.append("film_type",t.film_type),a.append("country",t.country),t.film_img&&a.append("film_img",t.film_img),console.log(a),a.append("categories",t.categories),a.append("directors",t.directors),a.append("actors",t.actors);try{const i=localStorage.getItem("jwt");if(!i){console.error("JWT token is missing");return}if(!(await fetch("/api/admin/films/create",{method:"POST",headers:{Authorization:"Bearer "+i},body:JSON.stringify(a)})).ok)throw new Error("Failed to create movie");u({open:!0,message:"Phim đã được tạo thành công!",severity:"success"}),setTimeout(()=>navigate("/admin/movie"),1e3)}catch{o({film_name:"",film_img:null,film_trailer:"",Release_date:"",film_describe:"",age_limit:5,duration:"",film_type:1,country:1,categories:[],directors:[],actors:[]}),u({open:!0,message:"Có lỗi xảy ra khi tạo phim!",severity:"error"})}},C=r=>{try{const a=/(?:https?:\/\/)?youtu\.be\/([^&\s]+)/,i=r.match(a);if(i)return`https://www.youtube.com/embed/${i[1]}`;const s=/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&\s]+)/,p=r.match(s);return p?`https://www.youtube.com/embed/${p[1]}`:r}catch(a){return console.error("Error transforming YouTube URL:",a),r}};return e.jsxs(T,{children:[e.jsxs(S,{children:[e.jsx(R,{title:e.jsx(g,{variant:"h2",children:"Mẫu tạo phim mới"})}),e.jsx(W,{children:e.jsxs("form",{onSubmit:v,children:[e.jsxs(F,{spacing:3,children:[e.jsx(l,{name:"film_name",label:"Tên phim",value:t.film_name,onChange:n,required:!0,fullWidth:!0}),e.jsxs(c,{display:"flex",flexDirection:"column",alignItems:"center",sx:{width:"300px"},children:[e.jsx(c,{sx:{width:"300px",height:"450px",backgroundColor:"#e0e0e0",border:"1px solid #ccc",borderRadius:"4px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",overflow:"hidden"},children:t.film_img?e.jsx("img",{src:t.film_img,alt:"Movie Poster",style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"}}):e.jsx(g,{variant:"caption",color:"textSecondary",sx:{textAlign:"center"},children:"Chưa có poster phim"})}),e.jsx(c,{sx:{marginTop:"10px"},children:t.film_img?e.jsx(d,{onClick:j,variant:"outlined",color:"error",size:"small",children:"Xóa poster phim"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{accept:"image/*",id:"upload-poster",type:"file",style:{display:"none"},onChange:_}),e.jsx("label",{htmlFor:"upload-poster",children:e.jsx(d,{variant:"outlined",color:"info",size:"small",component:"span",children:"Thêm poster phim"})})]})})]}),t.film_trailer&&e.jsx(c,{children:e.jsx("iframe",{width:"50%",height:"315",src:C(t.film_trailer),title:"Movie Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsx(l,{name:"film_trailer",label:"Trailer URL (Shortened URL or Standard URL)",value:t.film_trailer,onChange:n,fullWidth:!0}),e.jsx(l,{name:"Release_date",label:"Ngày phát hành",type:"date",InputLabelProps:{shrink:!0},value:t.Release_date,onChange:n,required:!0,fullWidth:!0}),e.jsx(l,{name:"film_describe",label:"Mô tả",value:t.film_describe,onChange:n,multiline:!0,rows:4,required:!0,fullWidth:!0}),e.jsx(q,{options:[5,13,16,18],value:t.age_limit,onChange:(r,a)=>{o({...t,age_limit:a})},getOptionLabel:r=>r.toString(),renderInput:r=>e.jsx(l,{...r,name:"age_limit",label:"Giới hạn độ tuổi",type:"number",fullWidth:!0,required:!0})}),e.jsx(l,{name:"duration",label:"Thời lượng (phút)",type:"number",value:t.duration,onChange:n,required:!0,fullWidth:!0}),e.jsx(l,{name:"film_type",label:"Trạng thái phim",select:!0,value:t.film_type,onChange:n,required:!0,fullWidth:!0,children:b.map(r=>e.jsx(x,{value:r.value,children:r.label},r.value))}),e.jsx(l,{name:"country",label:"Quốc gia",select:!0,value:t.country,onChange:n,required:!0,fullWidth:!0,children:y.map(r=>e.jsx(x,{value:r.value,children:r.label},r.value))}),e.jsx(l,{name:"categories",label:"Thể loại (cách nhau bởi dấu phẩy)",value:t.categories,onChange:n,fullWidth:!0}),e.jsx(l,{name:"directors",label:"Đạo diễn (cách nhau bởi dấu phẩy)",value:t.directors,onChange:n,fullWidth:!0}),e.jsx(l,{name:"actors",label:"Diễn viên (cách nhau bởi dấu phẩy)",value:t.actors,onChange:n,fullWidth:!0})]}),e.jsx(c,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(d,{type:"submit",variant:"contained",color:"primary",children:"Tạo phim"})})]})})]}),e.jsx(k,{open:m.open,autoHideDuration:4e3,onClose:h,children:e.jsx(w,{onClose:h,severity:m.severity,children:m.message})})]})}function O(){return e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsxs("title",{children:[" ","Tạo phim | Trang quản trị website bán vé xem phim NHTT"]})}),e.jsx(A,{})]})}export{O as default};
