import{r as l,y as _,l as e,T as b,B as x,W as h,J as k,A as B,a4 as D}from"./TextField-BYjjVj_2.js";import{D as w,C as L,a as A,b as E,c as G,S as P,H as V}from"./admin-7nJNdn2s.js";import{S as W}from"./Stack-CclBrxki.js";import{A as f}from"./Autocomplete-C8kf00Qd.js";function q({cinemaId:i}){const[t,r]=l.useState({cinema_name:"",address:"",cluster_name:"",region_name:""}),[j,y]=l.useState(null),v=_(),[u,g]=l.useState(!0),[m,s]=l.useState({open:!1,message:"",severity:"success"}),d=()=>s(a=>({...a,open:!1})),p=a=>{const{name:n,value:o}=a.target;r(c=>({...c,[n]:o}))};l.useEffect(()=>{(async()=>{try{const n=localStorage.getItem("jwt");if(!n){console.error("JWT token is missing"),s({open:!0,message:"JWT token is missing",severity:"error"});return}const o=await fetch(`/api/admin/cinemas/detail/${i}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n}});if(!o.ok)throw new Error("Failed to fetch cinema details");const c=await o.json(),C=c.cinema[0]||{},H=c.clusters[0]||{},N=c.regions[0]||{},T={cinema_name:C.cinema_name||"",address:C.address||"",cluster_name:H.cluster_name||"",region_name:N.region_name||""};r(T),y(T),g(!1)}catch{s({open:!0,message:"Lỗi khi tải thông tin rạp",severity:"error"}),g(!1)}})()},[i]);const S=async a=>{a.preventDefault();try{const n=localStorage.getItem("jwt");if(!n){console.error("JWT token is missing"),s({open:!0,message:"JWT token is missing",severity:"error"});return}if(!(await fetch(`/api/admin/cinemas/edit/${i}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify(t)})).ok)throw new Error("Failed to update cinema");s({open:!0,message:"Rạp chiếu phim đã được cập nhật thành công!",severity:"success"}),setTimeout(()=>v("/admin/cinema"),1e3)}catch{r(j),s({open:!0,message:"Có lỗi xảy ra khi cập nhật rạp!",severity:"error"})}};return e.jsxs(w,{children:[e.jsxs(L,{children:[e.jsx(A,{title:e.jsx(b,{variant:"h2",children:"Chỉnh sửa thông tin rạp"})}),e.jsx(E,{children:u?e.jsx(x,{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",children:e.jsx(G,{})}):e.jsxs("form",{onSubmit:S,children:[e.jsxs(W,{spacing:3,children:[e.jsx(h,{name:"cinema_name",label:"Tên rạp",value:t.cinema_name,onChange:p,required:!0,fullWidth:!0}),e.jsx(h,{name:"address",label:"Địa chỉ",value:t.address,onChange:p,required:!0,fullWidth:!0}),e.jsx(f,{name:"cluster_name",options:["Beta Cinemas","CGV Cinemas","Lotte Cinemas","Cinestar","Mega GS Cinemas","Dcine","Đống Đa Cinema","Starlight","Rio Cinemas","Touch Cinema","Cinemax","Love"],isOptionEqualToValue:(a,n)=>n!==null&&a.value===n.value,value:t.cluster_name,onChange:(a,n)=>{r({...t,cluster_name:n})},renderInput:a=>e.jsx(h,{...a,label:"Tên cụm rạp",required:!0})}),e.jsx(f,{name:"region_name",options:["Hà Nội","Tp.Hồ Chí Minh","Bình Dương","Đồng Nai","Cần Thơ","Đà Nẵng","Khánh Hòa","Lâm Đồng","Quảng Ninh","Bình Định","Bà Rịa-Vũng Tàu","Bắc Giang","Đắk Lắk","Gia Lai","Hải Phòng","Thừa-Thiên Huế","Kiên Giang","Kon Tum","Nghệ An","Quảng Bình","Quảng Nam","Sóc Trăng","Tây Ninh","Thái Nguyên","Thanh Hóa","Tiên Giang","An Giang","Bắc Ninh","Bình Thuận","Cà Mau","Đồng Tháp","Hà Nam","Hà Tĩnh","Hải Dương","Hậu Giang","Hưng Yên","Lạng Sơn","Lào Cai","Long An","Nam Định","Ninh BÌnh","Ninh Thuận","Phú Thọ","Quảng Ngãi","Quảng Trị","Sơn La","Trà Vinh","Tuyên Quang","Vĩnh Long","Yên Bái"],isOptionEqualToValue:(a,n)=>n!==null&&a.value===n.value,value:t.region_name,onChange:(a,n)=>{r({...t,region_name:n})},renderInput:a=>e.jsx(h,{...a,label:"Khu vực",required:!0})})]}),e.jsx(x,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(k,{type:"submit",variant:"contained",color:"primary",disabled:u,children:"Cập nhật"})})]})})]}),e.jsx(P,{open:m.open,autoHideDuration:4e3,onClose:d,children:e.jsx(B,{onClose:d,severity:m.severity,children:m.message})})]})}function K(){const{id:i}=D();return e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsxs("title",{children:[" ","Chỉnh sửa thông tin rạp chiếu phim | NHTT Admin Panel"]})}),e.jsx(q,{cinemaId:i})]})}export{K as default};
